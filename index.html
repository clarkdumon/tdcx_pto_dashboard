<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workforce Management Web App</title>
</head>
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
<link rel="stylesheet" href="style.css">

<body>

  <div class="sidebar">
    <div class="header-logo">
      <h3>Workforce Management</h3>
      <h4>Web App</h4>
    </div>
    <div class="sidebar-menu">
      <div class="sidebar-menu-item">
        <span class="material-symbols-rounded">dashboard</span>
        <h3>Dashboard</h3>
      </div>
      <div class="sidebar-menu-item">
        <span class="material-symbols-rounded">timer</span>
        <h3>Wait list</h3>
      </div>
      <div class="sidebar-menu-item">
        <span class="material-symbols-rounded">partner_exchange</span>
        <h3>Allocation</h3>
      </div>
    </div>
    <div class="sidebar-userdetails">
      <div class="userdetails">
        <h4 id="userdetails-name">Clark Laurent Dumon</h4>
        <p id="userdetails-tier">Resolutions 1</p>
        <p id="userdetails-role">Support Ambassador</p>
      </div>
      <div class="userhelp">
        <span class="material-symbols-rounded">help</span>
        <p>Help Center</p>
      </div>
    </div>
  </div>
  <div class="content-area">
    <div class="content-header">
      <div class="maincontent_wrapper">
        <h1>Dashboard</h1>
      </div>
      <div class="subcontent_wrapper">
        <button type="button" id="pto_request_btn" class="btn-info">Request PTO</button>
        <dialog id="pto_request_dialog">
          <div class="dialog-header">
            <span class="material-symbols-rounded" id="pto_request_btn_close">cancel</span>
            <h2>PTO Form</h2>
          </div>
          <div class="dialog-form">
            <label for="inpdate_leavedate">Leave Date</label>
            <input type="date" name="inpdate_leavedate" id="inpdate_leavedate">
            <label for="textarea_ptoreason">PTO Reason</label>
            <textarea name="textarea_ptoreason" id="textarea_ptoreason" placeholder="Reason of request"></textarea>
            <button type="button" id="btn_pto_submit_request" class="btn-info">Submit Request</button>
          </div>
        </dialog>

      </div>
    </div>
    <div class="table-area">
      <div class="table-wrapper">
        <table>
          <caption>Requested PTO</caption>
          <thead>
            <tr>
              <th><input type="checkbox" name="" id=""></th>
              <th>Transaction ID</th>
              <th>Timestamp</th>
              <th>Sender</th>
              <th>Recipient</th>
              <th>Leave Date</th>
              <th>Status</th>
              <th>Remarks</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="checkbox" name="" id=""></td>
              <td>17cb8cd5-4837-4a10-a8c6-56e1f3b9f1f3</td>
              <td>07/06/2025, 01:08:45</td>
              <td>testsender.sender@tdcx.com</td>
              <td>testrecipient.recipient@tdcx.com</td>
              <td>7/7/2025</td>
              <td>Approved</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td><input type="checkbox" name="" id=""></td>
              <td>17cb8cd5-4837-4a10-a8c6-56e1f3b9f1f3</td>
              <td>07/06/2025, 01:08:45</td>
              <td>testsender.sender@tdcx.com</td>
              <td>testrecipient.recipient@tdcx.com</td>
              <td>7/7/2025</td>
              <td>Denied</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td><input type="checkbox" name="" id=""></td>
              <td>17cb8cd5-4837-4a10-a8c6-56e1f3b9f1f3</td>
              <td>07/06/2025, 01:08:45</td>
              <td>testsender.sender@tdcx.com</td>
              <td>testrecipient.recipient@tdcx.com</td>
              <td>7/7/2025</td>
              <td>Cancelled</td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td><input type="checkbox" name="" id=""></td>
              <td>17cb8cd5-4837-4a10-a8c6-56e1f3b9f1f3</td>
              <td>07/06/2025, 01:08:45</td>
              <td>testsender.sender@tdcx.com</td>
              <td>testrecipient.recipient@tdcx.com</td>
              <td>7/7/2025</td>
              <td>Waitlisted</td>
              <td></td>
              <td></td>
            </tr>
                        <tr>
              <td><input type="checkbox" name="" id=""></td>
              <td>17cb8cd5-4837-4a10-a8c6-56e1f3b9f1f3</td>
              <td>07/06/2025, 01:08:45</td>
              <td>testsender.sender@tdcx.com</td>
              <td>testrecipient.recipient@tdcx.com</td>
              <td>7/7/2025</td>
              <td>Pending</td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
        <div class="table-pagination">1 2 3 4 5 ...</div>
      </div>

    </div>
  </div>

</body>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.10/+esm'
  const supabase = createClient('https://jhqxioqnviaxdjlauyir.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpocXhpb3FudmlheGRqbGF1eWlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4ODQ2MjksImV4cCI6MjA2NDQ2MDYyOX0.DAP7sLjxZCtbS-0G4c4brSda6wL2u9mC3QLBfKBXOUM')


  const openPtoBtn = document.querySelector('button#pto_request_btn');
  const ptoModal = document.querySelector('dialog#pto_request_dialog');
  const closePtoBtn = document.querySelector('#pto_request_btn_close');
  const submitBtn = document.querySelector('#btn_pto_submit_request');

  // ptoModal.showModal()
  openPtoBtn.addEventListener('click', () => {
    document.querySelector('#inpdate_leavedate').max = getLastDateOfMonthThreeMonthsFromToday();
    document.querySelector('#inpdate_leavedate').min = '2025-06-29';
    ptoModal.showModal()
  });
  closePtoBtn.addEventListener('click', () => ptoModal.close())
  submitBtn.addEventListener('click', sendPtoRequest)



  // close modal when clicking outside
  ptoModal.addEventListener('click', event => { offsideModalClick(event) });


  function offsideModalClick(action) {
    const rect = ptoModal.getBoundingClientRect();
    const isInDialog =
      event.clientX >= rect.left &&
      event.clientX <= rect.right &&
      event.clientY >= rect.top &&
      event.clientY <= rect.bottom;

    if (!isInDialog) {
      ptoModal.close();
    }
  }


  async function sendPtoRequest() {
    let payload = {
      created_at: new Date,
      leave_date: document.querySelector('#inpdate_leavedate').value,
      requested_by: 'testrequested@tdcx.com',
      requestee: 'testrequestee@tdcx.com',
      status: 'APPROVED',
      pto_reason: document.querySelector('#textarea_ptoreason').value,
    }
    console.log(payload)

    const { data, error } = await supabase
      .from('db_pto_request')
      .insert(payload)
      .select()
    console.log(data)
    console.log(error)

    if (error == null) {
      ptoModal.close()
    }
    getPtoRequests()
  }

  async function getPtoRequests() {
    let { data, error } = await supabase
      .from('db_pto_request')
      .select('*')
    console.log(data)
  }

  function getLastDateOfMonthThreeMonthsFromToday() {
    const today = new Date();
    const targetDate = new Date(today.getFullYear(), today.getMonth() + 3 + 1, 0); // "+1" to move to next month, "0" to get last day of previous
    return `${targetDate.toLocaleDateString().split("/")[2]}-${targetDate.toLocaleDateString().split("/")[0].padStart(2,'0')}-${targetDate.toLocaleDateString().split("/")[1].padStart(2,'0')}`
  }



</script>

</html>